generator client {
    provider      = "prisma-client-js"
    binaryTargets = ["native", "rhel-openssl-1.1.x"]
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model user_info {
    id         Int        @id @default(autoincrement())
    user_name  String     @db.VarChar(10)
    password   String     @db.VarChar(20)
    avatar_url String     @db.VarChar(255)
    pet_name   String     @db.VarChar(20)
    describe   String     @db.Text
    sign       String     @db.Text
    tags       user_tag[]
}

model tag {
    id       Int        @id @default(autoincrement())
    name     String     @db.VarChar(50)
    icon     String     @db.VarChar(255)
    url      String     @db.VarChar(255)
    type     TagType    @default(BLOG)
    color    String     @default("#000000") @db.VarChar(20)
    blog_tag blog_tag[]
    users    user_tag[]

    @@unique([name, type], map: "uk_name_type")
}

model blog {
    id          Int        @id @default(autoincrement())
    title       String
    subtitle    String
    created_at  DateTime   @default(now())
    updated_at  DateTime   @updatedAt
    content     String     @db.Text
    date_path   String     @default("1997-01-01-103523") @db.VarChar(255)
    front_cover String     @db.VarChar(255)
    views       Int        @default(0)
    tags        blog_tag[]
}

model blog_tag {
    blog_id Int
    tag_id  Int
    blog    blog @relation(fields: [blog_id], references: [id], onDelete: Cascade)
    tag     tag  @relation(fields: [tag_id], references: [id])

    @@id([blog_id, tag_id])
    @@index([tag_id], map: "blog_tag_tag_id_fkey")
}

model user_tag {
    user_id Int
    tag_id  Int
    tag     tag       @relation(fields: [tag_id], references: [id])
    user    user_info @relation(fields: [user_id], references: [id])

    @@id([user_id, tag_id])
    @@index([tag_id], map: "user_tag_tag_id_fkey")
}

model record_groups {
    id         Int              @id @default(autoincrement())
    time_range String           @unique @db.VarChar(255)
    title      String           @db.VarChar(255)
    role       String           @db.VarChar(255)
    summary    String           @db.Text
    created_at DateTime         @default(now())
    updated_at DateTime         @updatedAt
    details    record_details[]

    @@map("record_groups")
}

model record_details {
    id         Int             @id @default(autoincrement())
    group_id   Int
    title      String          @db.VarChar(100)
    summary    String          @db.Text
    time_range String          @db.VarChar(20)
    image_alt  String          @db.VarChar(200)
    created_at DateTime        @default(now())
    updated_at DateTime        @updatedAt
    date_path  String          @default("1997-01-01-103523") @db.VarChar(255)
    views      Int             @default(0)
    group      record_groups   @relation(fields: [group_id], references: [id], onDelete: Cascade)
    images     record_images[]

    @@index([group_id], map: "record_details_group_id_fkey")
    @@map("record_details")
}

model record_images {
    id               Int            @id @default(autoincrement())
    record_detail_id Int
    url              String         @db.VarChar(500)
    detail           record_details @relation(fields: [record_detail_id], references: [id], onDelete: Cascade)

    @@index([record_detail_id], map: "record_images_record_detail_id_fkey")
}

model error_report {
    id         Int      @id @default(autoincrement())
    name       String
    email      String
    content    String
    created_at DateTime @default(now())
}

model blog_views_daily {
    id        Int      @id @default(autoincrement())
    blog_id   Int
    view_date DateTime
    views     Int      @default(0)

    @@unique([blog_id, view_date], name: "blog_id_view_date")
    @@index([blog_id], map: "blog_views_daily_blog_id_fkey")
}

model record_details_views_daily {
    id               Int      @id @default(autoincrement())
    record_detail_id Int
    view_date        DateTime
    views            Int      @default(0)

    @@unique([record_detail_id, view_date], name: "record_detail_id_view_date")
    @@index([record_detail_id], map: "record_details_views_daily_record_detail_id_fkey")
}

enum TagType {
    BLOG
    PERSON
}
