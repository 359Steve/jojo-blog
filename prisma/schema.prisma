// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

enum TagType {
    BLOG // 博客标签
    PERSON // 个人标签
}

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "mysql"
    url      = env("DATABASE_URL")
}

model user_info {
    id         Int        @id @default(autoincrement())
    user_name  String     @db.VarChar(10)
    password   String     @db.VarChar(20)
    avatar_url String     @db.VarChar(255)
    pet_name   String     @db.VarChar(20)
    sign       String     @db.Text
    describe   String     @db.Text
    tags       user_tag[]
}

model tag {
    id       Int        @id @default(autoincrement())
    name     String     @db.VarChar(50)
    icon     String     @db.VarChar(255)
    url      String     @db.VarChar(255)
    type     TagType    @default(BLOG)
    blog_tag blog_tag[]
    users    user_tag[]

    @@unique([name, type], map: "uk_name_type") // 同一类型下标签名称唯一
}

model blog {
    id          Int        @id @default(autoincrement())
    title       String
    front_cover String     @db.VarChar(255)
    subtitle    String
    content     String     @db.Text
    created_at  DateTime   @default(now())
    updated_at  DateTime   @updatedAt
    tags        blog_tag[]
}

model blog_tag {
    blog_id Int
    tag_id  Int
    blog    blog @relation(fields: [blog_id], references: [id])
    tag     tag  @relation(fields: [tag_id], references: [id])

    @@id([blog_id, tag_id])
}

model user_tag {
    user_id Int
    tag_id  Int
    user    user_info @relation(fields: [user_id], references: [id])
    tag     tag       @relation(fields: [tag_id], references: [id])

    @@id([user_id, tag_id])
}

model record_group {
    id         Int      @id @default(autoincrement())
    time_range Int      @unique
    title      String   @db.VarChar(255)
    role       String   @db.VarChar(255)
    summary    String   @db.Text
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    details record_detail[]

    @@map("record_groups")
}

model record_detail {
    id         Int      @id @default(autoincrement())
    group_id   Int
    title      String   @db.VarChar(100)
    summary    String   @db.Text
    time_range String   @db.VarChar(20)
    image_url  String   @db.VarChar(500)
    image_alt  String   @db.VarChar(200)
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt

    group record_group @relation(fields: [group_id], references: [id], onDelete: Cascade)

    @@map("record_details")
}
